# Environment Variables Documentation

## Overview

This document provides comprehensive documentation for all environment variables used in the NGSRN website, organized by deployment phase and feature requirements.

## Table of Contents

1. [Deployment Phases](#deployment-phases)
2. [Required Variables](#required-variables)
3. [Optional Variables](#optional-variables)
4. [Feature Flags](#feature-flags)
5. [Vercel Integration](#vercel-integration)
6. [Security Considerations](#security-considerations)
7. [Validation and Testing](#validation-and-testing)

## Deployment Phases

### Simple Deployment Phase

**Purpose**: Static website deployment without database dependencies
**Use Case**: Initial deployment, demonstration, testing
**Features**: Basic pages, navigation, optional analytics

#### Required Variables
- `NEXT_PUBLIC_BASE_URL` - Application base URL
- `NEXT_PUBLIC_SITE_NAME` - Website display name

#### Feature Flags (Simple)
```bash
NEXT_PUBLIC_ENABLE_CMS="false"
NEXT_PUBLIC_ENABLE_AUTH="false"
NEXT_PUBLIC_ENABLE_SEARCH="false"
NEXT_PUBLIC_ENABLE_AI="false"
NEXT_PUBLIC_ENABLE_MEDIA="false"
```

### Full Deployment Phase

**Purpose**: Complete application with all features enabled
**Use Case**: Production deployment with content management
**Features**: CMS, authentication, search, AI, media management

#### Required Variables
- `NEXT_PUBLIC_BASE_URL` - Application base URL
- `NEXT_PUBLIC_SITE_NAME` - Website display name
- `DATABASE_URL` - PostgreSQL database connection
- `DIRECT_URL` - Direct database connection for migrations
- `NEXTAUTH_SECRET` - Authentication secret key
- `NEXTAUTH_URL` - Authentication callback URL

#### Feature Flags (Full)
```bash
NEXT_PUBLIC_ENABLE_CMS="true"
NEXT_PUBLIC_ENABLE_AUTH="true"
NEXT_PUBLIC_ENABLE_SEARCH="true"
NEXT_PUBLIC_ENABLE_AI="true"
NEXT_PUBLIC_ENABLE_MEDIA="true"
```

## Required Variables

### NEXT_PUBLIC_BASE_URL
- **Description**: The base URL of your application
- **Format**: `https://your-domain.com`
- **Vercel Auto-provided**: Yes (from VERCEL_URL)
- **Example**: `https://ngsrn-website.vercel.app`
- **Setup**: 
  - Vercel: Auto-generated from deployment URL
  - Manual: Set in Vercel dashboard for custom domains
- **Validation**: Must be valid HTTPS URL for production

### NEXT_PUBLIC_SITE_NAME
- **Description**: Display name for your website
- **Format**: String (any length)
- **Vercel Auto-provided**: No
- **Example**: `NextGen Sustainable Research Network`
- **Setup**: Set in Vercel dashboard Environment Variables
- **Required For**: All deployments

### DATABASE_URL
- **Description**: PostgreSQL database connection string
- **Format**: `postgresql://user:password@host:port/database`
- **Vercel Auto-provided**: No
- **Example**: `postgresql://user:pass@db.supabase.co:5432/postgres`
- **Setup**: Get from database provider (Supabase, Railway, etc.)
- **Required For**: Full deployment only
- **Security**: Store in Vercel dashboard, never in code

### DIRECT_URL
- **Description**: Direct database connection for migrations and pooling
- **Format**: `postgresql://user:password@host:port/database`
- **Vercel Auto-provided**: No
- **Example**: Same as DATABASE_URL for most providers
- **Setup**: Usually same as DATABASE_URL
- **Required For**: Full deployment only

### NEXTAUTH_SECRET
- **Description**: Secret key for NextAuth.js session encryption
- **Format**: Random string (32+ characters recommended)
- **Vercel Auto-provided**: No
- **Example**: `your-32-character-secret-key-here`
- **Setup**: Generate with `openssl rand -base64 32`
- **Required For**: Full deployment with authentication
- **Security**: Must be cryptographically secure

### NEXTAUTH_URL
- **Description**: Canonical URL for NextAuth.js callbacks
- **Format**: `https://your-domain.com`
- **Vercel Auto-provided**: Yes (from VERCEL_URL)
- **Example**: `https://ngsrn-website.vercel.app`
- **Setup**: Auto-generated by Vercel or set for custom domains
- **Required For**: Full deployment with authentication

## Optional Variables

### NEXT_PUBLIC_GA_ID
- **Description**: Google Analytics 4 measurement ID
- **Format**: `G-XXXXXXXXXX`
- **Vercel Auto-provided**: No
- **Example**: `G-1234567890`
- **Setup**: Get from Google Analytics dashboard
- **Required For**: Analytics tracking (optional)

### GEMINI_API_KEY
- **Description**: Google Gemini AI API key for AI features
- **Format**: API key string
- **Vercel Auto-provided**: No
- **Example**: `AIzaSyC...`
- **Setup**: Get from Google AI Studio
- **Required For**: AI assistant features (optional)

### AWS_ACCESS_KEY_ID
- **Description**: AWS access key for S3 media storage
- **Format**: AWS access key string
- **Vercel Auto-provided**: No
- **Example**: `AKIAIOSFODNN7EXAMPLE`
- **Setup**: Create in AWS IAM
- **Required For**: Media upload features (optional)

### AWS_SECRET_ACCESS_KEY
- **Description**: AWS secret key for S3 media storage
- **Format**: AWS secret key string
- **Vercel Auto-provided**: No
- **Example**: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`
- **Setup**: Create in AWS IAM
- **Required For**: Media upload features (optional)
- **Security**: Highly sensitive, store securely

### AWS_S3_BUCKET
- **Description**: AWS S3 bucket name for media storage
- **Format**: S3 bucket name
- **Vercel Auto-provided**: No
- **Example**: `ngsrn-media-bucket`
- **Setup**: Create S3 bucket in AWS
- **Required For**: Media upload features (optional)

### REDIS_URL
- **Description**: Redis connection string for caching
- **Format**: `redis://user:password@host:port`
- **Vercel Auto-provided**: No
- **Example**: `redis://default:password@redis.provider.com:6379`
- **Setup**: Get from Redis provider
- **Required For**: Advanced caching (optional)

### ELASTICSEARCH_URL
- **Description**: Elasticsearch connection string for search
- **Format**: `https://user:password@host:port`
- **Vercel Auto-provided**: No
- **Example**: `https://elastic:password@search.provider.com:9200`
- **Setup**: Get from Elasticsearch provider
- **Required For**: Advanced search features (optional)

## Feature Flags

Feature flags control which parts of the application are enabled. They must be set according to your deployment phase.

### NEXT_PUBLIC_ENABLE_CMS
- **Description**: Enables content management system
- **Values**: `"true"` | `"false"`
- **Simple**: `"false"`
- **Full**: `"true"`
- **Dependencies**: Requires DATABASE_URL, NEXTAUTH_SECRET

### NEXT_PUBLIC_ENABLE_AUTH
- **Description**: Enables user authentication
- **Values**: `"true"` | `"false"`
- **Simple**: `"false"`
- **Full**: `"true"`
- **Dependencies**: Requires NEXTAUTH_SECRET, NEXTAUTH_URL

### NEXT_PUBLIC_ENABLE_SEARCH
- **Description**: Enables search functionality
- **Values**: `"true"` | `"false"`
- **Simple**: `"false"`
- **Full**: `"true"`
- **Dependencies**: Requires DATABASE_URL or ELASTICSEARCH_URL

### NEXT_PUBLIC_ENABLE_AI
- **Description**: Enables AI assistant features
- **Values**: `"true"` | `"false"`
- **Simple**: `"false"`
- **Full**: `"true"`
- **Dependencies**: Requires GEMINI_API_KEY

### NEXT_PUBLIC_ENABLE_MEDIA
- **Description**: Enables media upload and management
- **Values**: `"true"` | `"false"`
- **Simple**: `"false"`
- **Full**: `"true"`
- **Dependencies**: Requires AWS credentials or alternative storage

## Vercel Integration

### Auto-Provided Variables

Vercel automatically provides these variables during deployment:

- `VERCEL` - Set to `"1"` when running on Vercel
- `VERCEL_URL` - Deployment URL (without protocol)
- `VERCEL_ENV` - Environment: `production`, `preview`, or `development`
- `VERCEL_REGION` - Deployment region (e.g., `iad1`)
- `VERCEL_GIT_*` - Git integration variables

### URL Auto-Generation

When deploying to Vercel:
- `NEXT_PUBLIC_BASE_URL` is auto-generated from `VERCEL_URL`
- `NEXTAUTH_URL` is auto-generated from `VERCEL_URL`
- Only set these manually if using custom domains

### Environment Precedence

1. Vercel dashboard variables (highest priority)
2. Local `.env.production` file
3. Local `.env.local` file
4. Local `.env` file (lowest priority)

## Security Considerations

### Sensitive Variables

These variables contain sensitive information and should only be set in Vercel dashboard:
- `DATABASE_URL`
- `DIRECT_URL`
- `NEXTAUTH_SECRET`
- `GEMINI_API_KEY`
- `AWS_SECRET_ACCESS_KEY`

### Public Variables

Variables prefixed with `NEXT_PUBLIC_` are exposed to the browser:
- Only use for non-sensitive configuration
- Never include API keys or secrets
- Safe for client-side code

### Best Practices

1. **Never commit secrets to git**
2. **Use strong, unique secrets (32+ characters)**
3. **Rotate secrets regularly**
4. **Use environment-specific values**
5. **Validate all variables before deployment**

## Validation and Testing

### Validation Commands

```bash
# Validate current environment
npm run env:validate

# Validate specific phase
npm run env:validate simple
npm run env:validate full

# Check feature flags
npm run env:check-flags

# Validate build environment
npm run build:validate
```

### Common Validation Errors

#### Missing Required Variables
```
‚ùå NEXT_PUBLIC_SITE_NAME is required but not set
üí° Set in Vercel dashboard: NEXT_PUBLIC_SITE_NAME = "Your Site Name"
```

#### Invalid Format
```
‚ùå NEXT_PUBLIC_BASE_URL must be a valid HTTPS URL
üí° Current: http://localhost:3000
üí° Expected: https://your-app.vercel.app
```

#### Feature Flag Conflicts
```
‚ùå CMS is enabled but authentication is disabled
üí° Set NEXT_PUBLIC_ENABLE_AUTH="true" or disable CMS
```

#### Vercel URL Mismatch
```
‚ùå NEXT_PUBLIC_BASE_URL conflicts with Vercel auto-generated URL
üí° Remove manual setting to use Vercel auto-generated URL
```

### Testing Environment Variables

```bash
# Test with specific environment
NEXT_PUBLIC_ENABLE_CMS=true npm run build:validate

# Test Vercel deployment locally
vercel dev

# Pull Vercel environment variables
vercel env pull .env.local
```

## Quick Reference

### Simple Deployment Checklist
- [ ] `NEXT_PUBLIC_BASE_URL` (auto-generated by Vercel)
- [ ] `NEXT_PUBLIC_SITE_NAME`
- [ ] All feature flags set to `"false"`
- [ ] Optional: `NEXT_PUBLIC_GA_ID`

### Full Deployment Checklist
- [ ] All simple deployment variables
- [ ] `DATABASE_URL`
- [ ] `DIRECT_URL`
- [ ] `NEXTAUTH_SECRET`
- [ ] `NEXTAUTH_URL` (auto-generated by Vercel)
- [ ] All feature flags set to `"true"`
- [ ] Optional service API keys as needed

### Emergency Recovery
If deployment fails due to environment variables:
1. Run `npm run build:validate` to identify issues
2. Check Vercel dashboard for missing variables
3. Use `npm run env:prepare:simple` for quick recovery
4. Redeploy after fixing variables